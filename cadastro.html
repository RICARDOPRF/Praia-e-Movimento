<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Criar Conta — Praia & Movimento</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,700&family=Plus+Jakarta+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <script>
    tailwind.config = { theme: { extend: { colors: { sand: "#F7E9D7", ink: "#0C0C0C", gold: "#C9A44F" } } } }
  </script>
</head>
<body class="bg-sand text-ink font-sans min-h-screen flex flex-col">
  <header class="p-6 flex justify-center">
    <a href="index.html" class="font-serif text-2xl font-bold italic">Praia & Movimento</a>
  </header>

  <main class="flex-1 flex items-center justify-center px-6 py-12">
    <div class="bg-white w-full max-w-xl rounded-[3rem] p-10 shadow-xl">
      <h1 class="font-serif text-3xl mb-8 text-center italic">Cadastre-se</h1>
      
      <form id="form-cadastro" class="space-y-4">
        <input type="text" id="cad-nome" placeholder="Nome Completo" class="w-full border-b border-black/10 py-3 outline-none focus:border-gold" required>
        
        <div class="grid grid-cols-2 gap-4">
          <input type="tel" id="cad-tel" placeholder="Telefone (DDD)" class="border-b border-black/10 py-3 outline-none focus:border-gold" required>
          <input type="text" id="cad-insta" placeholder="@Instagram" class="border-b border-black/10 py-3 outline-none focus:border-gold">
        </div>

        <input type="email" id="cad-email" placeholder="E-mail" class="w-full border-b border-black/10 py-3 outline-none focus:border-gold" required>
        
        <input type="password" id="cad-senha" placeholder="Escolha uma Senha" class="w-full border-b border-black/10 py-3 outline-none focus:border-gold" required>
        
        <div class="pt-4 grid grid-cols-2 gap-4">
          <input type="text" id="cad-cidade" placeholder="Cidade" class="border-b border-black/10 py-3 outline-none focus:border-gold" required>
          <input type="text" id="cad-estado" placeholder="Estado" class="border-b border-black/10 py-3 outline-none focus:border-gold" required>
        </div>

        <div class="grid grid-cols-3 gap-4">
          <input type="text" id="cad-rua" placeholder="Rua" class="col-span-2 border-b border-black/10 py-3 outline-none focus:border-gold" required>
          <input type="text" id="cad-num" placeholder="Nº" class="border-b border-black/10 py-3 outline-none focus:border-gold" required>
        </div>

        <button type="submit" id="btn-cadastrar" class="w-full bg-ink text-white py-4 rounded-full font-bold tracking-widest mt-8 hover:bg-gold transition shadow-lg">
          CRIAR MINHA CONTA
        </button>
      </form>
      <p class="text-center mt-6 text-sm text-black/40">Já tem conta? <a href="login.html" class="text-ink font-bold underline">Entrar</a></p>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
    import { firebaseConfig } from "./site.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const form = document.getElementById('form-cadastro');
    const btn = document.getElementById('btn-cadastrar');

    form.onsubmit = async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('cad-email').value;
      const senha = document.getElementById('cad-senha').value;
      const nome = document.getElementById('cad-nome').value;

      btn.innerText = "CRIANDO CONTA...";
      btn.disabled = true;

      try {
        // 1. Criar usuário no Auth
        const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
        const user = userCredential.user;

        // 2. Salvar dados extras no Realtime Database
        await set(ref(db, 'usuarios/' + user.uid), {
          nome: nome,
          telefone: document.getElementById('cad-tel').value,
          email: email,
          cidade: document.getElementById('cad-cidade').value,
          estado: document.getElementById('cad-estado').value,
          rua: document.getElementById('cad-rua').value,
          numero: document.getElementById('cad-num').value,
          instagram: document.getElementById('cad-insta').value,
          uid: user.uid
        });

        // 3. Login local para persistência rápida nas páginas
        localStorage.setItem("usuario_logado", JSON.stringify({
          uid: user.uid,
          nome: nome,
          email: email
        }));

        alert("Bem-vinda à Praia & Movimento!");
        window.location.href = "index.html";

      } catch (error) {
        btn.innerText = "CRIAR MINHA CONTA";
        btn.disabled = false;
        
        if (error.code === 'auth/email-already-in-use') {
          alert("Este e-mail já está em uso.");
        } else if (error.code === 'auth/weak-password') {
          alert("A senha deve ter pelo menos 6 caracteres.");
        } else {
          alert("Erro no cadastro: " + error.message);
        }
      }
    };
  </script>
</body>
</html>